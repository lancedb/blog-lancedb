.nav__container {
  @include mq($max: $lg) {
    $header-height: var(--header-height);
    overflow: hidden;
    position: absolute;
    width: 100%;
    top: calc(100% - 1px);
    padding: 0;
    left: 0;
    height: 0;
    transition: all 0.3s ease-out;
    background-color: palette(primary-dark);
    z-index: 100;

    .open & {
      height: calc(100dvh - var(--header-height));
      transition-timing-function: ease-in;
    }
  }
}

.nav__wrap {
  display: flex;
  justify-content: stratch;
  align-items: center;

  @include mq($lg) {
    & > * {
      flex: 1 1 0px;
    }
  }

  @include mq($max: $lg) {
    overflow-y: scroll;
    flex-direction: column;
    justify-content: flex-start;
    align-items: stretch;
    height: 100%;
    gap: 56px;
    padding-left: value-to-rem($container-padding);
    padding-right: value-to-rem($container-padding);
    padding-top: 46px;
    padding-bottom: 46px;
  }
}

.nav__list {
  padding-bottom: 56px;
  border-bottom: 1px solid palette(primary-grey, 100);

  @include mq($lg) {
    padding: 0;
    border: none;
    display: flex;
    gap: 24px;
    align-items: center;
    justify-content: flex-start;
    width: auto;
    margin: 0;
  }

  @include mq($xl) {
    gap: 48px;
  }
}

.nav__item {
  @include clear-font();
  
  @include mq($lg) {
    margin: 0;
  }
}

.nav__link {
  display: block;
  @include font(nav_mob, 34, 400);
  color: palette(primary-offwhite);
  text-decoration: none;
  transition: color 0.3s ease-in-out;
  display: block;
  padding: 26px 16px;
  border-bottom: 1px dashed palette(primary-grey, 100);

  .nav__item:first-of-type &{
    padding-top: 0;
  }

  .nav__item:last-of-type &{
    padding-bottom: 0;
    border-bottom: none;
  }

  @include mq($lg) {
    @include font(nav, 22, 400);
    padding: 0;
    border: none;
    color: palette(primary-offwhite);
    white-space: nowrap;

    &:hover {
      color: palette(primary-dark, 400);
    }

  }

  &.active {
    color: palette(primary-orange);
  }

  // Styles for Careers link in right section
  &.nav__link--right {
    @include mq($lg) {
      @include font(nav, 22, 400);
      color: palette(primary-offwhite);
      text-decoration: none;
      transition: color 0.3s ease-in-out;
      white-space: nowrap;
      margin-right: 2px;

      &:hover {
        color: palette(primary-dark, 400);
      }
    }
  }
}

.nav__additional {
  display: flex;
  flex-direction: column;
  gap: 56px;
  justify-content: space-between;

  @include mq($lg) {
    flex-direction: row;
    gap: 40px;
    align-items: center;
    justify-content: flex-end;
  }
}

.nav__socials-wrap {
  display: flex;
  flex-direction: column;
  gap: 20px;

  @include mq($max: $lg) {
    padding-left: 16px;
  }
}

.nav__socials {
  display: flex;
  align-items: center;
  gap: 26px;

  @include mq($lg) {
    gap: 20px;
  }

  li {
    @include clear-font();
  }
}

.nav__social-link {
  width: 24px;
  height: 24px;
  display: block;
  transition: all 0.3s ease-in-out;
  color: palette(primary-offwhite);
  flex-shrink: 0;
  svg {
    width: 100%;
    height: 100%;
    transition: all 0.3s ease-in-out;
  }
  &:hover {
    color: palette(primary-dark, 400);
  }
}

.nav__item--has-children { 
  position: relative; 

  .nav__link {
    display: flex;
    align-items: center;
    justify-content: space-between;

    gap: 6px;
  }

  &:hover{
    .nav__caret { transform: rotate(180deg); opacity: 1; }

    &::after {
      content: "";
      position: absolute;
      top: 100%;
      left: 0;
      width: 100%;
      height: 14px; /* hover buffer to bridge the gap to submenu */
    }
  }
}

.nav__caret { 
  display: block;
  padding: 12px;
  transition: transform .2s ease, color .2s ease; 
  opacity: .9; 
  height: fit-content;

  @include mq($md) {
    padding: 0px;
  }
}

.nav__submenu {
  position: absolute;
  top: calc(100% + 10px);
  left: 0;
  min-width: 240px;
  background: rgba(20, 22, 25, 0.96);
  -webkit-backdrop-filter: blur(8px);
  backdrop-filter: blur(8px);
  border: 1px solid rgba(255,255,255,0.08);
  box-shadow: 0 10px 30px rgba(0,0,0,0.35);
  border-radius: 10px;
  padding: 8px 0;
  z-index: 1000;
  opacity: 0;
  visibility: hidden;
  pointer-events: none;
  transform: translateY(6px);
  transition: opacity .16s ease, transform .16s ease, visibility .16s ease;
}

.nav__submenu:before {
  content: "";
  position: absolute;
  top: -7px;
  left: 18px;
  width: 12px;
  height: 12px;
  background: inherit;
  border-left: 1px solid rgba(255,255,255,0.08);
  border-top: 1px solid rgba(255,255,255,0.08);
  transform: rotate(45deg);

  @include mq($max: $lg) {
    display: none;
  }
}

.nav__submenu-item { 
  list-style: none; 
}
.nav__submenu-item + .nav__submenu-item { 
  border-top: 1px solid rgba(255,255,255,0.06); 
}

.nav__submenu-link {
  display: block;
  padding: 12px 16px;
  color: rgba(255,255,255,0.92);
  text-decoration: none;
  white-space: nowrap;
  font-size: 14px;
  line-height: 1.2;

  &:last-child {
    @include mq($max: $lg ) {
      border-bottom: 1px solid rgba(255,255,255,0.06); 
    }
  }
}

.nav__submenu-link:hover { background: rgba(255,255,255,0.06); color: #fff; }

/* Show on hover for desktop */
@media (hover: hover) and (pointer: fine) {
  .nav__item--has-children:hover > .nav__submenu,
  .nav__item--has-children > .nav__submenu:hover { opacity: 1; visibility: visible; pointer-events: auto; transform: none; }
}

/* Mobile accordion behavior */
.nav__item--has-children.open > .nav__submenu { opacity: 1; visibility: visible; pointer-events: auto; position: static; border: 0; box-shadow: none; background: transparent; padding: 6px 0 0; transform: none; }
.nav__item--has-children.open > .nav__link .nav__caret { transform: rotate(180deg); }