<!doctype html><html lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Creating a FinTech AI Agent From Scratch - LanceDB Blog</title><link rel=stylesheet href=/css/custom.css><link rel=stylesheet href=/css/syntax-highlighting.css><script src=/js/toc-progress.js></script><script src=/js/heading-links.js></script><script src=/js/announcement.js></script><script src=/js/code-blocks.js></script></head><body><div class=announcement-bar id=announcement-bar><div class=announcement-content><span>June 1st, 2025: LanceDB Cloud is now in public beta!</span>
<a href=https://lancedb.com/cloud class=announcement-link>Try it now →</a>
<button class=announcement-close onclick=closeAnnouncement()>×</button></div></div><header class=site-header><div class=header-content><a href=/ class=site-title><img src=/assets/blog/logo.png alt="LanceDB Blog" class=site-logo></a><div class=header-links><a href=/docs class=header-link>Documentation</a>
<a href=/pricing class=header-link>Pricing</a>
<a href=/get-started class="header-link get-started">Get Started</a></div></div></header><div class=content-wrapper><div class=toc-container><div class=toc><h2>Table of Contents</h2><nav id=TableOfContents><ul><li><a href=#whats-the-deal-here>What&rsquo;s the Deal Here?</a></li><li><a href=#big-picture>Big Picture!</a></li><li><a href=#step-1-setting-up-the-stage---libraries-and-setup>Step 1: Setting Up the Stage - Libraries and Setup</a></li><li><a href=#step-2-loan-agent---predictive-analysis-with-ml>Step 2: Loan Agent - Predictive Analysis with ML</a><ul><li><a href=#loading-the-demo-data>Loading the Demo Data</a></li><li><a href=#building-the-ml-model>Building the ML Model</a></li><li><a href=#completing-the-integration-for-the-loan-agent>Completing the Integration for the Loan Agent</a></li></ul></li><li><a href=#step-3-insurance-agent---vector-search-with-lancedb>Step 3: Insurance Agent - Vector Search with LanceDB</a></li><li><a href=#step-4-completion-of-kernel-agent>Step 4: Completion of Kernel Agent</a></li></ul></nav></div></div><main><h1>Creating a FinTech AI Agent From Scratch</h1><div class=post-meta><span class=post-category>Engineering</span>
<span class=meta-divider>•</span>
<span class=post-author>Vipul Maheshwari</span>
<span class=meta-divider>•</span>
<span class=post-date>February 27, 2025</span></div><article class=single-post><img src=/assets/blog/creating-a-fintech-agent/creating-a-fintech-agent.png alt="Creating a FinTech AI Agent From Scratch" class=preview-image><div class=post-content><p>AI agents are popping up everywhere, and they&rsquo;re only going to become more common in the next few years. Think of them as a bunch of little digital assistants—agents—that keep an eye on things, make decisions, and get stuff done. It makes me wonder: how are we going to manage all these agents down the road? How do we trust them to handle decisions for us and let them run on their own?</p><p>These days, many frameworks are out there to help you with AI agents quickly. Honestly, it feels like a new &ldquo;low-code&rdquo; tool shows up every other day, promising to make building agents a breeze. They&rsquo;re all over the place—simple drag-and-drop setups or text boxes where you plug in a few prompts and some data, and just like that, your agent&rsquo;s ready to go.</p><p>Every AI agent has three main pieces at its core: the Model, the Tools, and the Reasoning Loop.</p><ol><li><p><strong>The Model</strong>: This is the Large Language Model (LLM) that drives the agent. It&rsquo;s the brain behind it all, trained on piles of text to understand language and tackle tricky instructions. This is what lets the agent think and talk almost like a person.</p></li><li><p><strong>The Tools</strong>: The agent uses specific skills to interact with the world and get things done. Whether it&rsquo;s grabbing data, hitting up APIs, or working with other programs, the tools are what make the agent useful.</p></li><li><p><strong>The Reasoning Loop</strong>: This is how the agent figures things out. It&rsquo;s the process it uses to solve problems, pick the best path forward, and wrap up tasks.</p></li></ol><p>In this post, I&rsquo;m going to mix things up a little. Instead of leaning on a framework, I&rsquo;ll walk you through building a fintech agent from scratch using Python. This one&rsquo;s going to help with decisions about loans and insurance.</p><h2 id=whats-the-deal-here>What&rsquo;s the Deal Here?</h2><p>So how does this fintech agent work? Well, picture yourself running a FinTech company. Customers come at you with stuff like, &ldquo;Can I borrow $10K for a new kitchen? I&rsquo;m 26 years old,&rdquo; or &ldquo;I crashed my car—will you cover it?&rdquo; Haha, I&rsquo;d probably shut that insurance claim down real quick.</p><p>The point is, that we need a system that&rsquo;s fast, sharp, and reliable when it comes to deciding on loan requests and insurance claims. So, what I did is this: instead of one lone agent handling everything, I split it into three—Loan, Insurance, and a Kernel agent.</p><ol><li><p><strong>Loan Agent</strong>: Takes a query, figures out what they want (like &ldquo;home improvement&rdquo;), and uses an ML model to predict if they&rsquo;re good for the loan based on age, income, and the amount.</p></li><li><p><strong>Insurance Agent</strong>: Reads a claim, checks it against past cases, and decides if it&rsquo;s worth paying out—kind of like a semantic search over a claims database.</p></li><li><p><strong>Kernel Agent</strong>: The brains that tie it all together, sending queries to the right place.</p></li></ol><p>Now the question always comes of why raw Python? Well, the most viable reason is flexibility. I&rsquo;m just putting together a proof of concept here, and companies can easily tweak it to fit their own data and needs—no black-box framework nonsense. The Credit Risk Dataset and synthetic claims are just placeholders; real firms would swap in their own loan histories and claim records.</p><h2 id=big-picture>Big Picture!</h2><p>Ok so what we&rsquo;ve got is a Kernel Agent directing traffic, a Loan Agent predicting eligibility with machine learning, and an Insurance Agent checking claims against a vector database.</p><p>I&rsquo;m using the <a href=https://www.kaggle.com/datasets/laotse/credit-risk-dataset>Credit Risk Dataset</a> as a demo for loans. In reality, companies could use something like a CIBIL score to see if someone&rsquo;s eligible. But for this POC, I grabbed that dataset, trained a random forest model, and used it for predictive analysis. For the insurance agent, I built a synthetic pipeline to whip up a dataset of fake insurance queries. The target&rsquo;s simple: if the claim gets approved based on the conversation, it&rsquo;s a one. These are just placeholders to show how it works; companies can plug in their own data instead. Saying that, let&rsquo;s get started.</p><h2 id=step-1-setting-up-the-stage---libraries-and-setup>Step 1: Setting Up the Stage - Libraries and Setup</h2><p>We start by grabbing our tools—libraries that handle data, models, and vectors</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>pip install pandas joblib pyarrow sentence-transformers lancedb mistralai
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pandas</span> <span class=k>as</span> <span class=nn>pd</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>joblib</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pyarrow</span> <span class=k>as</span> <span class=nn>pa</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sentence_transformers</span> <span class=kn>import</span> <span class=n>SentenceTransformer</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>lancedb</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>mistralai</span> <span class=kn>import</span> <span class=n>Mistral</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>abc</span> <span class=kn>import</span> <span class=n>ABC</span><span class=p>,</span> <span class=n>abstractmethod</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>Any</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Abstract Tool Class</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Tool</span><span class=p>(</span><span class=n>ABC</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=nd>@abstractmethod</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>name</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>pass</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@abstractmethod</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>description</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>pass</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@abstractmethod</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>use</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Any</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>pass</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Initialize Mistral and Embedder</span>
</span></span><span class=line><span class=cl><span class=n>api_key</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>environ</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;MISTRAL_API_KEY&#34;</span><span class=p>,</span> <span class=s2>&#34;xxxxxxxxxxxxx&#34;</span><span class=p>)</span>  
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=ow>not</span> <span class=n>api_key</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&#34;Please set the MISTRAL_API_KEY environment variable.&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>model</span> <span class=o>=</span> <span class=s2>&#34;mistral-large-latest&#34;</span>
</span></span><span class=line><span class=cl><span class=n>client</span> <span class=o>=</span> <span class=n>Mistral</span><span class=p>(</span><span class=n>api_key</span><span class=o>=</span><span class=n>api_key</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>hf_token</span> <span class=o>=</span> <span class=s2>&#34;hf_xxxxxxx&#34;</span>
</span></span><span class=line><span class=cl><span class=n>embedder</span> <span class=o>=</span> <span class=n>SentenceTransformer</span><span class=p>(</span><span class=s1>&#39;all-MiniLM-L6-v2&#39;</span><span class=p>,</span> <span class=n>token</span><span class=o>=</span><span class=n>hf_token</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Connect to LanceDB</span>
</span></span><span class=line><span class=cl><span class=n>db</span> <span class=o>=</span> <span class=n>lancedb</span><span class=o>.</span><span class=n>connect</span><span class=p>(</span><span class=s1>&#39;./lancedb_data&#39;</span><span class=p>)</span>
</span></span></code></pre></div><p>For the quick demonstration, I am going to use <code>mistral-large-latest</code> a model from the Mistral for LLM tasks and the intent classification in the Loan queries. The <code>Tool</code> class is our way to keep the agents modular - every tool gets a clear job.</p><h2 id=step-2-loan-agent---predictive-analysis-with-ml>Step 2: Loan Agent - Predictive Analysis with ML</h2><p>As soon as a query comes in, the Loan Agent uses its ML tool to spin up the predictions. I am using the <a href=https://www.kaggle.com/datasets/laotse/credit-risk-dataset>Credit Risk Dataset</a> here.</p><h3 id=loading-the-demo-data>Loading the Demo Data</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>loan_data</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>read_csv</span><span class=p>(</span><span class=s1>&#39;./credit_risk_dataset.csv&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>loan_data</span><span class=o>.</span><span class=n>head</span><span class=p>()</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>   person_age  person_income  loan_amnt  loan_intent  loan_status
</span></span><span class=line><span class=cl>0          22          59000      35000     PERSONAL            1
</span></span><span class=line><span class=cl>1          21           9600       1000    EDUCATION            0
</span></span></code></pre></div><div class="admonition note"><div class=admonition-content><div class=admonition-title>Why Credit Risk Dataset?</div>It&rsquo;s public, well-structured, and mimics real loan data with features like loan_status (0 = approved, 1 = rejected). For demo purposes, it&rsquo;s spot-on. Companies would swap this for their own credit records—same columns, different rows, or maybe other relevant benchmarks that can be utilized for setting up the target in terms of the loan status.</div></div><h3 id=building-the-ml-model>Building the ML Model</h3><p>For the sake of the demonstration, I have used a Random Forest Classifier here. You can literally play around with different sets of these models, ensemble them, and get better in terms of accuracy and data processing.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sklearn.model_selection</span> <span class=kn>import</span> <span class=n>train_test_split</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sklearn.preprocessing</span> <span class=kn>import</span> <span class=n>OneHotEncoder</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sklearn.compose</span> <span class=kn>import</span> <span class=n>ColumnTransformer</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sklearn.ensemble</span> <span class=kn>import</span> <span class=n>RandomForestClassifier</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sklearn.pipeline</span> <span class=kn>import</span> <span class=n>Pipeline</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>joblib</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>features</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;person_age&#39;</span><span class=p>,</span> <span class=s1>&#39;person_income&#39;</span><span class=p>,</span> <span class=s1>&#39;loan_amnt&#39;</span><span class=p>,</span> <span class=s1>&#39;loan_intent&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>target</span> <span class=o>=</span> <span class=s1>&#39;loan_status&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>loan_data</span> <span class=o>=</span> <span class=n>loan_data</span><span class=o>.</span><span class=n>dropna</span><span class=p>(</span><span class=n>subset</span><span class=o>=</span><span class=n>features</span> <span class=o>+</span> <span class=p>[</span><span class=n>target</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>preprocessor</span> <span class=o>=</span> <span class=n>ColumnTransformer</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>transformers</span><span class=o>=</span><span class=p>[(</span><span class=s1>&#39;cat&#39;</span><span class=p>,</span> <span class=n>OneHotEncoder</span><span class=p>(</span><span class=n>handle_unknown</span><span class=o>=</span><span class=s1>&#39;ignore&#39;</span><span class=p>),</span> <span class=p>[</span><span class=s1>&#39;loan_intent&#39;</span><span class=p>])],</span>
</span></span><span class=line><span class=cl>    <span class=n>remainder</span><span class=o>=</span><span class=s1>&#39;passthrough&#39;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>X</span> <span class=o>=</span> <span class=n>loan_data</span><span class=p>[</span><span class=n>features</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>y</span> <span class=o>=</span> <span class=n>loan_data</span><span class=p>[</span><span class=n>target</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>X_train</span><span class=p>,</span> <span class=n>X_test</span><span class=p>,</span> <span class=n>y_train</span><span class=p>,</span> <span class=n>y_test</span> <span class=o>=</span> <span class=n>train_test_split</span><span class=p>(</span><span class=n>X</span><span class=p>,</span> <span class=n>y</span><span class=p>,</span> <span class=n>test_size</span><span class=o>=</span><span class=mf>0.2</span><span class=p>,</span> <span class=n>random_state</span><span class=o>=</span><span class=mi>42</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>model</span> <span class=o>=</span> <span class=n>Pipeline</span><span class=p>(</span><span class=n>steps</span><span class=o>=</span><span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=s1>&#39;preprocessor&#39;</span><span class=p>,</span> <span class=n>preprocessor</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=s1>&#39;classifier&#39;</span><span class=p>,</span> <span class=n>RandomForestClassifier</span><span class=p>(</span><span class=n>random_state</span><span class=o>=</span><span class=mi>42</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>model</span><span class=o>.</span><span class=n>fit</span><span class=p>(</span><span class=n>X_train</span><span class=p>,</span> <span class=n>y_train</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>accuracy</span> <span class=o>=</span> <span class=n>model</span><span class=o>.</span><span class=n>score</span><span class=p>(</span><span class=n>X_test</span><span class=p>,</span> <span class=n>y_test</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Model accuracy: </span><span class=si>{</span><span class=n>accuracy</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>  <span class=c1># 0.84</span>
</span></span><span class=line><span class=cl><span class=n>joblib</span><span class=o>.</span><span class=n>dump</span><span class=p>(</span><span class=n>model</span><span class=p>,</span> <span class=s1>&#39;loan_approval_model.pkl&#39;</span><span class=p>)</span>
</span></span></code></pre></div><ul><li><strong>Why Random Forest</strong>? Well as we know, Random forest comes under the ensemble category, and it&rsquo;s robust in nature, handles mixed data (numbers and categories) well, and gives us probabilities—not just yes/no. For loans, that&rsquo;s gold; banks love knowing the odds though.</li><li><strong>How It Works</strong>: We preprocess <code>loan_intent</code> into numbers (e.g., &ldquo;MEDICAL&rdquo; becomes a categorical encoded number), split the data, train, and test. Got an 84% accuracy which is decent for a demo. Real data could boost or tweak that.</li><li><strong>Swap It Out</strong>: As I said earlier, companies can use their own loan data here—same features, their numbers. Train it fresh, and it&rsquo;s tailored to them.</li></ul><h3 id=completing-the-integration-for-the-loan-agent>Completing the Integration for the Loan Agent</h3><p>Now comes the agent itself:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>PredictiveMLTool</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>model</span> <span class=o>=</span> <span class=n>joblib</span><span class=o>.</span><span class=n>load</span><span class=p>(</span><span class=s1>&#39;loan_approval_model.pkl&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>use</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>intent</span><span class=p>,</span> <span class=n>age</span><span class=p>,</span> <span class=n>income</span><span class=p>,</span> <span class=n>loan_amount</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>input_data</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=p>[[</span><span class=n>age</span><span class=p>,</span> <span class=n>income</span><span class=p>,</span> <span class=n>loan_amount</span><span class=p>,</span> <span class=n>intent</span><span class=p>]],</span>
</span></span><span class=line><span class=cl>            <span class=n>columns</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;person_age&#39;</span><span class=p>,</span> <span class=s1>&#39;person_income&#39;</span><span class=p>,</span> <span class=s1>&#39;loan_amnt&#39;</span><span class=p>,</span> <span class=s1>&#39;loan_intent&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>prob_approved</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>model</span><span class=o>.</span><span class=n>predict_proba</span><span class=p>(</span><span class=n>input_data</span><span class=p>)[</span><span class=mi>0</span><span class=p>][</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Probability for the loan approval is: </span><span class=si>{</span><span class=n>prob_approved</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s2>&#34;Eligible&#34;</span> <span class=k>if</span> <span class=n>prob_approved</span> <span class=o>&gt;</span> <span class=mf>0.5</span> <span class=k>else</span> <span class=s2>&#34;Not Eligible&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>LoanAgent</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>tools</span> <span class=o>=</span> <span class=p>[</span><span class=n>PredictiveMLTool</span><span class=p>()]</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>llm</span> <span class=o>=</span> <span class=n>llm</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>process</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>query</span><span class=p>,</span> <span class=n>params</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>intent</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>extract_intent</span><span class=p>(</span><span class=n>query</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>age</span> <span class=o>=</span> <span class=n>params</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;age&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>income</span> <span class=o>=</span> <span class=n>params</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;income&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>loan_amount</span> <span class=o>=</span> <span class=n>params</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;loan_amount&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>tools</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>use</span><span class=p>(</span><span class=n>intent</span><span class=p>,</span> <span class=n>age</span><span class=p>,</span> <span class=n>income</span><span class=p>,</span> <span class=n>loan_amount</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>extract_intent</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>query</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>valid_intents</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;DEBTCONSOLIDATION&#39;</span><span class=p>,</span> <span class=s1>&#39;EDUCATION&#39;</span><span class=p>,</span> <span class=s1>&#39;HOMEIMPROVEMENT&#39;</span><span class=p>,</span> <span class=s1>&#39;MEDICAL&#39;</span><span class=p>,</span> <span class=s1>&#39;PERSONAL&#39;</span><span class=p>,</span> <span class=s1>&#39;VENTURE&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>prompt</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;Given the query: &#39;</span><span class=si>{</span><span class=n>query</span><span class=si>}</span><span class=s2>&#39;, classify the intent into one of: </span><span class=si>{</span><span class=s1>&#39;, &#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>valid_intents</span><span class=p>)</span><span class=si>}</span><span class=s2>. Respond with only the intent in uppercase (e.g., &#39;HOMEIMPROVEMENT&#39;). If unsure, respond with &#39;PERSONAL&#39;.&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>response</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>llm</span><span class=p>(</span><span class=n>prompt</span><span class=p>)[</span><span class=mi>0</span><span class=p>][</span><span class=s1>&#39;generated_text&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span><span class=o>.</span><span class=n>upper</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>response</span> <span class=k>if</span> <span class=n>response</span> <span class=ow>in</span> <span class=n>valid_intents</span> <span class=k>else</span> <span class=s1>&#39;PERSONAL&#39;</span>
</span></span></code></pre></div><ul><li><strong>Why ML Here</strong>? It&rsquo;s predictive, which means it takes raw data and spits out a decision. LLM handles intent because it&rsquo;s quick and decent for text, though companies might use something beefier or their own intent rules. I let the LLM decide what&rsquo;s the intent here.</li><li><strong>How It Fits</strong>: Query → Intent (e.g., &ldquo;school fees&rdquo; → EDUCATION) → ML prediction. It&rsquo;s as simple as the tool&rsquo;s the muscle, and the agent&rsquo;s the coordinator.</li></ul><p>If the companies need a different logic to get the target status in terms if the loan can be provided to an individual or not, as I said earlier, they can easily replace the predictive ml modeling with another set of benchmarks or maybe thresholding some different set of metrics to figure out if that person is made for the loan or not.</p><p>To make things more smoother, let&rsquo;s introduce our Kernel Agent which will be used for redirecting the queries to the Loan and the Insurance agent based on the query type.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>KernelAgent</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>loan_agent</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>loan_agent</span> <span class=o>=</span> <span class=n>loan_agent</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>process_query</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>query</span><span class=p>,</span> <span class=n>params</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>loan_agent</span><span class=o>.</span><span class=n>process</span><span class=p>(</span><span class=n>query</span><span class=p>,</span> <span class=n>params</span><span class=p>)</span>
</span></span></code></pre></div><p>Well, this is good, but let&rsquo;s not forget we now need to work on our Insurance agent.</p><h2 id=step-3-insurance-agent---vector-search-with-lancedb>Step 3: Insurance Agent - Vector Search with LanceDB</h2><p>Before diving in, I want to walk you through my thought process for creating the Insurance Agent. Picture this: you walk into an insurance company, sit down with someone, and start explaining why you need to file a claim—why it&rsquo;s legit and why you deserve it. That conversation is key because it&rsquo;s the starting point for deciding whether the claim gets processed or not.</p><p>I tried hunting down a dataset with those kinds of conversations and clear <code>yes</code> or <code>no</code> labels for claims, but I came up empty. So, to keep things moving, I built a simple synthetic dataset pipeline. It generates a fake dataset with text queries on one side and a target on the other—showing if the person filing the claim is eligible or not.</p><p>Now, let&rsquo;s talk about where the VectorDB comes in. Here&rsquo;s the plan: we&rsquo;ll embed those insurance claim queries first. Then, when a new claim pops up, we&rsquo;ll pull the k-most similar queries from the database, look at their average eligibility scores, and use that to decide if the new query deserves a legitimate claim or not. With that in mind, let&rsquo;s start by generating some synthetic claims for the automotive industry. This is just a quick demo—companies can swap in real conversations instead, and you can tweak the pipeline a bit to handle actual data.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>random</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>csv</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>mistralai</span> <span class=kn>import</span> <span class=n>Mistral</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>api_key</span> <span class=o>=</span> <span class=s2>&#34;xxxxxxxxxxxxxxx&#34;</span>
</span></span><span class=line><span class=cl><span class=n>model</span> <span class=o>=</span> <span class=s2>&#34;mistral-large-latest&#34;</span>
</span></span><span class=line><span class=cl><span class=n>client</span> <span class=o>=</span> <span class=n>Mistral</span><span class=p>(</span><span class=n>api_key</span><span class=o>=</span><span class=n>api_key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>base_prompt</span> <span class=o>=</span> <span class=s2>&#34;Generate a detailed query for an auto insurance claim...&#34;</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>generate_query</span><span class=p>(</span><span class=n>denied</span><span class=o>=</span><span class=kc>False</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>prompt</span> <span class=o>=</span> <span class=n>base_prompt</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>denied</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>prompt</span> <span class=o>+=</span> <span class=s2>&#34; Include a reason the claim might be denied (e.g., drunk driving, uninsured vehicle).&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>response</span> <span class=o>=</span> <span class=n>client</span><span class=o>.</span><span class=n>chat</span><span class=o>.</span><span class=n>complete</span><span class=p>(</span><span class=n>model</span><span class=o>=</span><span class=n>model</span><span class=p>,</span> <span class=n>messages</span><span class=o>=</span><span class=p>[{</span><span class=s2>&#34;role&#34;</span><span class=p>:</span> <span class=s2>&#34;user&#34;</span><span class=p>,</span> <span class=s2>&#34;content&#34;</span><span class=p>:</span> <span class=n>prompt</span><span class=p>}],</span> <span class=n>max_tokens</span><span class=o>=</span><span class=mi>200</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>response</span><span class=o>.</span><span class=n>choices</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>message</span><span class=o>.</span><span class=n>content</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>assign_target</span><span class=p>(</span><span class=n>query</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>rejection_keywords</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;drunk&#34;</span><span class=p>,</span> <span class=s2>&#34;influence&#34;</span><span class=p>,</span> <span class=s2>&#34;racing&#34;</span><span class=p>,</span> <span class=s2>&#34;uninsured&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span> <span class=k>if</span> <span class=nb>any</span><span class=p>(</span><span class=n>kw</span> <span class=ow>in</span> <span class=n>query</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span> <span class=k>for</span> <span class=n>kw</span> <span class=ow>in</span> <span class=n>rejection_keywords</span><span class=p>)</span> <span class=k>else</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>dataset</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>100</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>denied</span> <span class=o>=</span> <span class=n>random</span><span class=o>.</span><span class=n>random</span><span class=p>()</span> <span class=o>&lt;</span> <span class=mf>0.4</span>
</span></span><span class=line><span class=cl>    <span class=n>query</span> <span class=o>=</span> <span class=n>generate_query</span><span class=p>(</span><span class=n>denied</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>target</span> <span class=o>=</span> <span class=n>assign_target</span><span class=p>(</span><span class=n>query</span><span class=p>)</span> <span class=k>if</span> <span class=ow>not</span> <span class=n>denied</span> <span class=k>else</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=n>dataset</span><span class=o>.</span><span class=n>append</span><span class=p>({</span><span class=s2>&#34;query&#34;</span><span class=p>:</span> <span class=n>query</span><span class=p>,</span> <span class=s2>&#34;target&#34;</span><span class=p>:</span> <span class=n>target</span><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s2>&#34;auto_insurance_claims.csv&#34;</span><span class=p>,</span> <span class=s2>&#34;w&#34;</span><span class=p>,</span> <span class=n>newline</span><span class=o>=</span><span class=s2>&#34;&#34;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>writer</span> <span class=o>=</span> <span class=n>csv</span><span class=o>.</span><span class=n>DictWriter</span><span class=p>(</span><span class=n>f</span><span class=p>,</span> <span class=n>fieldnames</span><span class=o>=</span><span class=p>[</span><span class=s2>&#34;query&#34;</span><span class=p>,</span> <span class=s2>&#34;target&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=n>writer</span><span class=o>.</span><span class=n>writeheader</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>writer</span><span class=o>.</span><span class=n>writerows</span><span class=p>(</span><span class=n>dataset</span><span class=p>)</span>
</span></span></code></pre></div><p>To make it a bit more realistic, I have included some of the rejection keywords like <code>drunk</code>, <code>influence</code>, <code>racing</code> and the <code>uninsured</code> which is readily used to make the dataset better in terms of the realistic cases where the claims are not processed. Running this will generate a CSV with the relevant data.</p><p>Now comes the LanceDB setup&mldr;</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pyarrow</span> <span class=k>as</span> <span class=nn>pa</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>df</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>read_csv</span><span class=p>(</span><span class=s1>&#39;auto_insurance_claims.csv&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>embeddings</span> <span class=o>=</span> <span class=n>embedder</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=n>df</span><span class=p>[</span><span class=s1>&#39;query&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>tolist</span><span class=p>())</span>
</span></span><span class=line><span class=cl><span class=n>embeddings_list</span> <span class=o>=</span> <span class=p>[</span><span class=n>embedding</span><span class=o>.</span><span class=n>tolist</span><span class=p>()</span> <span class=k>for</span> <span class=n>embedding</span> <span class=ow>in</span> <span class=n>embeddings</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>schema</span> <span class=o>=</span> <span class=n>pa</span><span class=o>.</span><span class=n>schema</span><span class=p>([</span>
</span></span><span class=line><span class=cl>    <span class=n>pa</span><span class=o>.</span><span class=n>field</span><span class=p>(</span><span class=s2>&#34;embedding&#34;</span><span class=p>,</span> <span class=n>pa</span><span class=o>.</span><span class=n>list_</span><span class=p>(</span><span class=n>pa</span><span class=o>.</span><span class=n>float32</span><span class=p>(),</span> <span class=n>list_size</span><span class=o>=</span><span class=mi>384</span><span class=p>)),</span>
</span></span><span class=line><span class=cl>    <span class=n>pa</span><span class=o>.</span><span class=n>field</span><span class=p>(</span><span class=s2>&#34;target&#34;</span><span class=p>,</span> <span class=n>pa</span><span class=o>.</span><span class=n>int32</span><span class=p>()),</span>
</span></span><span class=line><span class=cl>    <span class=n>pa</span><span class=o>.</span><span class=n>field</span><span class=p>(</span><span class=s2>&#34;query&#34;</span><span class=p>,</span> <span class=n>pa</span><span class=o>.</span><span class=n>string</span><span class=p>())</span>
</span></span><span class=line><span class=cl><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>table</span> <span class=o>=</span> <span class=n>db</span><span class=o>.</span><span class=n>create_table</span><span class=p>(</span><span class=s2>&#34;insurance_queries&#34;</span><span class=p>,</span> <span class=n>schema</span><span class=o>=</span><span class=n>schema</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>df_lance</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>({</span><span class=s2>&#34;embedding&#34;</span><span class=p>:</span> <span class=n>embeddings_list</span><span class=p>,</span> <span class=s2>&#34;target&#34;</span><span class=p>:</span> <span class=n>df</span><span class=p>[</span><span class=s1>&#39;target&#39;</span><span class=p>],</span> <span class=s2>&#34;query&#34;</span><span class=p>:</span> <span class=n>df</span><span class=p>[</span><span class=s1>&#39;query&#39;</span><span class=p>]})</span>
</span></span><span class=line><span class=cl><span class=n>table</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>df_lance</span><span class=p>)</span>
</span></span></code></pre></div><p>As I said earlier, companies could load their real claim logs here instead. Now comes the main part, we are going to integrate the semantic tooling capability into our Insurance agent.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Insurance Agent Tools</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>SemanticSearchTool</span><span class=p>(</span><span class=n>Tool</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>table</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>table</span> <span class=o>=</span> <span class=n>table</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>embedder</span> <span class=o>=</span> <span class=n>embedder</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>name</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s2>&#34;Semantic Search Tool&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>description</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s2>&#34;Performs semantic search in LanceDB to assess claim approval based on similar past claims.&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>use</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>query</span><span class=p>,</span> <span class=n>k</span><span class=o>=</span><span class=mi>5</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>new_embedding</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>embedder</span><span class=o>.</span><span class=n>encode</span><span class=p>([</span><span class=n>query</span><span class=p>])[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>tolist</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>results</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>table</span><span class=o>.</span><span class=n>search</span><span class=p>(</span><span class=n>new_embedding</span><span class=p>)</span><span class=o>.</span><span class=n>limit</span><span class=p>(</span><span class=n>k</span><span class=p>)</span><span class=o>.</span><span class=n>to_pandas</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>approval_rate</span> <span class=o>=</span> <span class=n>results</span><span class=p>[</span><span class=s1>&#39;target&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>mean</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>similar_queries</span> <span class=o>=</span> <span class=n>results</span><span class=p>[</span><span class=s1>&#39;query&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>tolist</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>decision</span> <span class=o>=</span> <span class=s2>&#34;Approved&#34;</span> <span class=k>if</span> <span class=n>approval_rate</span> <span class=o>&gt;</span> <span class=mf>0.5</span> <span class=k>else</span> <span class=s2>&#34;Not Approved&#34;</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Approval rate among similar claims: </span><span class=si>{</span><span class=n>approval_rate</span><span class=o>*</span><span class=mi>100</span><span class=si>:</span><span class=s2>.1f</span><span class=si>}</span><span class=s2>%&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span><span class=s2>&#34;decision&#34;</span><span class=p>:</span> <span class=n>decision</span><span class=p>,</span> <span class=s2>&#34;similar_queries&#34;</span><span class=p>:</span> <span class=n>similar_queries</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Insurance Agent</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>InsuranceAgent</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>table</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>tools</span> <span class=o>=</span> <span class=p>[</span><span class=n>SemanticSearchTool</span><span class=p>(</span><span class=n>table</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>process</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>query</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>tools</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>use</span><span class=p>(</span><span class=n>query</span><span class=p>)</span>
</span></span></code></pre></div><p>This is it, let&rsquo;s integrate our Insurance agent within our Kernel agent along with the Loan Agent.</p><h2 id=step-4-completion-of-kernel-agent>Step 4: Completion of Kernel Agent</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Kernel Agent</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>KernelAgent</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>loan_agent</span><span class=p>,</span> <span class=n>insurance_agent</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>loan_agent</span> <span class=o>=</span> <span class=n>loan_agent</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>insurance_agent</span> <span class=o>=</span> <span class=n>insurance_agent</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>client</span> <span class=o>=</span> <span class=n>client</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>model</span> <span class=o>=</span> <span class=n>model</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>classify_query</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>query</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>prompt</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        Given the query: &#39;</span><span class=si>{</span><span class=n>query</span><span class=si>}</span><span class=s2>&#39;, classify it as &#39;loan&#39; or &#39;insurance&#39;.
</span></span></span><span class=line><span class=cl><span class=s2>        Respond with only &#39;loan&#39; or &#39;insurance&#39;.
</span></span></span><span class=line><span class=cl><span class=s2>        If unsure, respond with &#39;unknown&#39;.
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>response</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>chat</span><span class=o>.</span><span class=n>complete</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>model</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>model</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>messages</span><span class=o>=</span><span class=p>[{</span><span class=s2>&#34;role&#34;</span><span class=p>:</span> <span class=s2>&#34;user&#34;</span><span class=p>,</span> <span class=s2>&#34;content&#34;</span><span class=p>:</span> <span class=n>prompt</span><span class=p>}],</span>
</span></span><span class=line><span class=cl>            <span class=n>temperature</span><span class=o>=</span><span class=mf>0.7</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>max_tokens</span><span class=o>=</span><span class=mi>10</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Query type : </span><span class=si>{</span><span class=n>response</span><span class=o>.</span><span class=n>choices</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>message</span><span class=o>.</span><span class=n>content</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>response</span><span class=o>.</span><span class=n>choices</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>message</span><span class=o>.</span><span class=n>content</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>process_query</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>query</span><span class=p>,</span> <span class=n>params</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>query_type</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>classify_query</span><span class=p>(</span><span class=n>query</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>query_type</span> <span class=o>==</span> <span class=s1>&#39;loan&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=ow>not</span> <span class=n>params</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=s2>&#34;Error: Loan query requires parameters (age, income, loan_amount).&#34;</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>loan_agent</span><span class=o>.</span><span class=n>process</span><span class=p>(</span><span class=n>query</span><span class=p>,</span> <span class=n>params</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=n>query_type</span> <span class=o>==</span> <span class=s1>&#39;insurance&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>insurance_agent</span><span class=o>.</span><span class=n>process</span><span class=p>(</span><span class=n>query</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=s2>&#34;Error: Unable to classify query as &#39;loan&#39; or &#39;insurance&#39;.&#34;</span>
</span></span></code></pre></div><p>Now all you need to do is toss in a query—could be anything about loans or insurance. It&rsquo;ll hit the Kernel Agent first, and based on what the query&rsquo;s about, it&rsquo;ll get handed off to either the Loan Agent or the Insurance Agent. From there, they&rsquo;ll handle the rest of the decisions.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Test Cases</span>
</span></span><span class=line><span class=cl><span class=n>test_cases</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;query&#34;</span><span class=p>:</span> <span class=s2>&#34;I had a bad accident yesterday, but i think i was a bit drunk, need some insurance&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;params&#34;</span><span class=p>:</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Run Tests</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Testing Integrated System with Mistral:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;-&#34;</span> <span class=o>*</span> <span class=mi>50</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=k>case</span> <span class=ow>in</span> <span class=n>test_cases</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>query</span> <span class=o>=</span> <span class=k>case</span><span class=p>[</span><span class=s2>&#34;query&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>params</span> <span class=o>=</span> <span class=k>case</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;params&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>result</span> <span class=o>=</span> <span class=n>kernel_agent</span><span class=o>.</span><span class=n>process_query</span><span class=p>(</span><span class=n>query</span><span class=p>,</span> <span class=n>params</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Query: &#39;</span><span class=si>{</span><span class=n>query</span><span class=si>}</span><span class=s2>&#39;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>params</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Params: </span><span class=si>{</span><span class=n>params</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>result</span><span class=p>,</span> <span class=nb>dict</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Decision: </span><span class=si>{</span><span class=n>result</span><span class=p>[</span><span class=s1>&#39;decision&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Similar Queries:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>q</span> <span class=ow>in</span> <span class=n>result</span><span class=p>[</span><span class=s1>&#39;similar_queries&#39;</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;- </span><span class=si>{</span><span class=n>q</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Result: </span><span class=si>{</span><span class=n>result</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;-&#34;</span> <span class=o>*</span> <span class=mi>50</span><span class=p>)</span>
</span></span></code></pre></div><p>Think about the potential here: fintech companies can plug in their own tools and data to process loans and insurance claims. Picture how much manual work insurance folks put in, checking every little thing to figure out if a claim&rsquo;s legit or not—or the same deal with loans, deciding if someone qualifies. This could cut out so much of that hassle.</p><div class="admonition tip"><div class=admonition-content><div class=admonition-title>Complete Implementation</div><p>Refer to this <a href=https://colab.research.google.com/github/lancedb/vectordb-recipes/blob/main/examples/fintech-ai-agent/fintech-ai-agent.ipynb>Google Colab notebook</a> for complete code implementation.</p><p>Star 🌟 <a href=https://github.com/lancedb/vectordb-recipes/>LanceDB recipes</a> to keep yourself updated with high quality resources & applications for LLMs, multi-modal models and VectorDBs.</p></div></div></div></article><div class=author-section><img src=/assets/authors/community.jpg alt="Vipul Maheshwari" class=author-avatar><div class=author-info><h3 class=author-name>Vipul Maheshwari</h3><p class=author-bio>ML Engineer and FinTech enthusiast specializing in AI agents, predictive modeling, and financial technology applications.</p><div class=author-social></div></div></div><div class=related-posts><h2>Related Posts</h2><div class=related-posts-grid><article class=related-post><a href=/blog/columnar-file-readers-in-depth-repetition-definition-levels/><img src=/assets/blog/columnar-file-readers-in-depth-repetition-definition-levels/columnar-file-readers-in-depth-repetition-definition-levels.png alt="Columnar File Readers in Depth: Repetition & Definition Levels" class=related-preview-image></a><h3><a href=/blog/columnar-file-readers-in-depth-repetition-definition-levels/>Columnar File Readers in Depth: Repetition & Definition Levels</a></h3><div class=post-meta><span class=post-author>Weston Pace</span>
<span class=post-date>June 2, 2025</span></div></article><article class=related-post><a href=/blog/columnar-file-readers-in-depth-column-shredding/><img src=/assets/blog/columnar-file-readers-in-depth-column-shredding/columnar-file-readers-in-depth-column-shredding.png alt="Columnar File Readers in Depth: Column Shredding" class=related-preview-image></a><h3><a href=/blog/columnar-file-readers-in-depth-column-shredding/>Columnar File Readers in Depth: Column Shredding</a></h3><div class=post-meta><span class=post-author>Weston Pace</span>
<span class=post-date>May 15, 2025</span></div></article><article class=related-post><a href=/blog/columnar-file-readers-in-depth-compression-transparency/><img src=/assets/blog/columnar-file-readers-in-depth-compression-transparency/columnar-file-readers-in-depth-compression-transparency.png alt="Columnar File Readers in Depth: Compression Transparency" class=related-preview-image></a><h3><a href=/blog/columnar-file-readers-in-depth-compression-transparency/>Columnar File Readers in Depth: Compression Transparency</a></h3><div class=post-meta><span class=post-author>Weston Pace</span>
<span class=post-date>April 29, 2025</span></div></article></div></div></main></div><footer class=site-footer><div class=footer-content><a href=/ class=site-title><img src=/assets/blog/logo.png alt="LanceDB Blog" class=site-logo></a><div class=footer-links><a href=https://lancedb.com/documentation class=footer-link>Documentation</a>
<a href=https://lancedb.com/pricing class=footer-link>Pricing</a>
<a href=/get-started class="footer-link get-started">Get Started</a></div></div></footer></body></html>