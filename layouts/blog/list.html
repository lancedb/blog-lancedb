{{ define "main" }}
<div class="container">
{{ $allPosts := where .Site.RegularPages "Section" "blog" }}
{{ $featuredPosts := where $allPosts ".Params.featured" true }}

{{ $topFeatured := first 3 $featuredPosts.ByWeight }}

{{ $nonFeaturedPosts := $allPosts | complement $topFeatured }}


<!-- Create paginator -->
{{ $paginator := .Paginate $nonFeaturedPosts }}

<!-- Featured Section - Only show on first page -->
{{ if and $featuredPosts (eq $paginator.PageNumber 1) }}
    {{ $mainFeatured := index $topFeatured 0 }}
    {{ $sideFeatured := after 1 $topFeatured }}
    <div class="featured-section">
        <!-- Main Featured Post -->
        <article class="main-featured">
            <a href="{{ $mainFeatured.RelPermalink }}">
                <img src="{{ $mainFeatured.Params.image | default "/assets/blog/preview.png" }}" alt="{{ $mainFeatured.Title }}" class="preview-image">
            </a>
            <h2><a href="{{ $mainFeatured.RelPermalink }}">{{ $mainFeatured.Title }}</a></h2>
            <div class="post-meta">
                {{- range $index, $category := $mainFeatured.Params.categories -}}
                    {{- if $index }} / {{ end -}}
                    {{- $category -}}
                {{- end -}}
                {{- if $mainFeatured.Params.categories }} / {{ end -}}
                {{- if $mainFeatured.Params.author2 -}}
                    {{- $mainFeatured.Params.author }} & {{ $mainFeatured.Params.author2 -}}
                {{- else -}}
                    {{- $mainFeatured.Params.author -}}
                {{- end -}} / {{ $mainFeatured.Date.Format "January 2, 2006" -}}
            </div>
            <p class="post-description">{{ $mainFeatured.Description | default (truncate 160 $mainFeatured.Summary) }}</p>
        </article>
        <!-- Side Featured Posts -->
        <div class="side-featured">
            {{ range first 2 $sideFeatured }}
                <article class="side-featured-post">
                    <a href="{{ .RelPermalink }}">
                        <img src="{{ .Params.image | default "/assets/blog/preview.png" }}" alt="{{ .Title }}" class="preview-image">
                    </a>
                    <h2><a href="{{ .RelPermalink }}">{{ .Title }}</a></h2>
                    <div class="post-meta">
                        {{- range $index, $category := .Params.categories -}}
                            {{- if $index }} / {{ end -}}
                            {{- $category -}}
                        {{- end -}}
                        {{- if .Params.categories }} / {{ end -}}
                        {{- if .Params.author2 -}}
                            {{- .Params.author }} & {{ .Params.author2 -}}
                        {{- else -}}
                            {{- .Params.author -}}
                        {{ end }} / {{ .Date.Format "January 2, 2006" -}}
                    </div>
                </article>
            {{ end }}
        </div>
    </div>
{{ end }}

<!-- Pagination Section -->
<div class="pagination-subscribe-container">
    <div class="pagination-section">
        <nav class="pagination">
            <div class="pagination-links">
                {{ if $paginator.HasPrev }}
                    <a href="{{ $paginator.Prev.URL }}" class="pagination-link prev" rel="prev">
                        <span class="pagination-arrow">←</span>
                        <span class="pagination-text">Previous</span>
                    </a>
                {{ end }}
                
                <!-- All page numbers -->
                {{ range $paginator.Pagers }}
                    {{ if eq .PageNumber $paginator.PageNumber }}
                        <span class="pagination-link current">{{ .PageNumber }}</span>
                    {{ else }}
                        <a href="{{ .URL }}" class="pagination-link page-number">{{ .PageNumber }}</a>
                    {{ end }}
                {{ end }}
                
                {{ if $paginator.HasNext }}
                    <a href="{{ $paginator.Next.URL }}" class="pagination-link next" rel="next">
                        <span class="pagination-text">Next</span>
                        <span class="pagination-arrow">→</span>
                    </a>
                {{ end }}
                
                <!-- Subscribe button inside pagination-links -->
                <div class="subscribe-section">
                    <button class="subscribe-cta-button" onclick="openSubscribeModal()">
                        <span class="subscribe-icon">✉️</span>
                        <span class="subscribe-text">Subscribe</span>
                    </button>
                </div>
            </div>
        </nav>
    </div>
</div>
{{ partial "components/blog-categories.html" . }}
<!-- Posts Grid -->
<div class="post-grid">
    {{ range $paginator.Pages }}
        <article class="post-card">
            <a href="{{ .RelPermalink }}">
                <img src="{{ .Params.image | default "/assets/blog/preview.png" }}" alt="{{ .Title }}" class="preview-image">
            </a>
            <h2><a href="{{ .RelPermalink }}">{{ .Title }}</a></h2>
            <div class="post-meta">
                {{- range $index, $category := .Params.categories -}}
                    {{- if $index }} / {{ end -}}
                    {{- $category -}}
                {{- end -}}
                {{- if .Params.categories }} / {{ end -}}
                {{- if .Params.author2 -}}
                    {{- .Params.author }} & {{ .Params.author2 -}}
                {{- else -}}
                    {{- .Params.author -}}
                {{ end }} / {{ .Date.Format "January 2, 2006" -}}
            </div>
            <p class="post-description">{{ .Description | default (truncate 100 .Summary) }}</p>
        </article>
    {{ end }}
</div>

<!-- Pagination Navigation (Bottom) -->
{{ if gt $paginator.TotalPages 1 }}
<div class="pagination-subscribe-container">
    <nav class="pagination">
        <div class="pagination-links">
            {{ if $paginator.HasPrev }}
                <a href="{{ $paginator.Prev.URL }}" class="pagination-link prev" rel="prev">
                    <span class="pagination-arrow">←</span>
                    <span class="pagination-text">Previous</span>
                </a>
            {{ end }}
            
            <!-- All page numbers -->
            {{ range $paginator.Pagers }}
                {{ if eq .PageNumber $paginator.PageNumber }}
                    <span class="pagination-link current">{{ .PageNumber }}</span>
                {{ else }}
                    <a href="{{ .URL }}" class="pagination-link page-number">{{ .PageNumber }}</a>
                {{ end }}
            {{ end }}
            
            {{ if $paginator.HasNext }}
                <a href="{{ $paginator.Next.URL }}" class="pagination-link next" rel="next">
                    <span class="pagination-text">Next</span>
                    <span class="pagination-arrow">→</span>
                </a>
            {{ end }}
        </div>
    </nav>
</div>
{{ end }}
</div>

<!-- Subscribe Modal -->
<div id="subscribeModal" class="subscribe-modal">
    <div class="subscribe-modal-content">
        <div class="subscribe-modal-header">
                                            <h3 class="modal-title-primary">Become a LanceDB Insider!</h3>
                <p class="modal-subtitle">Subscribe for our exclusive updates and early access.</p>
        </div>
        <form class="subscribe-form" id="subscribeForm">
            <div class="form-row">
                <div class="form-group">
                    <label for="firstName">First Name *</label>
                    <input type="text" id="firstName" name="firstName" required>
                </div>
                <div class="form-group">
                    <label for="lastName">Last Name *</label>
                    <input type="text" id="lastName" name="lastName" required>
                </div>
            </div>
            <div class="form-group">
                <label for="email">Email Address *</label>
                <input type="email" id="email" name="email" required>
            </div>
            <div class="d-none">
                <label for="blog_submission"></label>
                <input type="checkbox" id="blog_submission" name="blog_submission" checked>
            </div>
            <div class="form-group agreement-text">
                <p>By subscribing, you agree to receive LanceDB updates. You can unsubscribe anytime. <a href="https://242023405.fs1.hubspotusercontent-na2.net/hubfs/242023405/Website%20Documentation/privacy.pdf" target="_blank">Read our Privacy Policy</a> for details.</p>
            </div>
            <button type="submit" class="subscribe-submit-btn">
                <span class="btn-text">Subscribe Now</span>
                <span class="btn-loading" style="display: none;">Subscribing...</span>
            </button>
        </form>
    </div>
</div>
{{ end }}