<ul class="sidebar-list">
  {{- range .Pages.ByWeight }}
    <li>
      {{- if eq .Params.layout "divider" }}
        {{- if .Params.link }}
          <a href="{{ .Params.link }}" class="sidebar-divider">{{ .Params.sidebar_title | default .Title }}</a>
        {{- else }}
          <div class="sidebar-divider">{{ .Params.sidebar_title | default .Title }}</div>
        {{- end }}
      {{- else if and .Pages (not .Params.sidebar_collapsed) }}
        <details {{ if or (eq .RelPermalink $.current.RelPermalink) (in $.current.RelPermalink .RelPermalink) }}open{{ end }}>
          <summary class="sidebar-summary">
            <span class="sidebar-arrow">
              {{ readFile "static/assets/icons/arrow_down.svg" | safeHTML }}
            </span>
            <div class="sidebar-link-wrapper">
              {{- if .Params.link }}
                {{- if hasPrefix .Params.link "http" }}
                  <a href="{{ .Params.link }}" class="sidebar-link{{ if eq .RelPermalink $.current.RelPermalink }} active{{ end }}" target="_blank" rel="noopener">
                    {{ .Params.sidebar_title | default .Title }}
                  </a>
                {{- else }}
                  <a href="{{ .Params.link }}" class="sidebar-link{{ if eq .RelPermalink $.current.RelPermalink }} active{{ end }}">
                    {{ .Params.sidebar_title | default .Title }}
                  </a>
                {{- end }}
              {{- else }}
                <a href="{{ .RelPermalink }}" class="sidebar-link{{ if eq .RelPermalink $.current.RelPermalink }} active{{ end }}">
                  {{ .Params.sidebar_title | default .Title }}
                </a>
              {{- end }}
            </div>
          </summary>
          {{ partial "docs-sidebar-recursive.html" (dict "Pages" .Pages "current" $.current) }}
        </details>
      {{- else if .Pages }}
        <!-- Section with children but collapsed - just show the link without expanding -->
        <div class="sidebar-summary">
          <span class="sidebar-arrow">
            {{ readFile "static/assets/icons/arrow_down.svg" | safeHTML }}
          </span>
          <div class="sidebar-link-wrapper">
            {{- if .Params.link }}
              {{- if hasPrefix .Params.link "http" }}
                <a href="{{ .Params.link }}" class="sidebar-link{{ if eq .RelPermalink $.current.RelPermalink }} active{{ end }}" target="_blank" rel="noopener">
                  {{ .Params.sidebar_title | default .Title }}
                </a>
              {{- else }}
                <a href="{{ .Params.link }}" class="sidebar-link{{ if eq .RelPermalink $.current.RelPermalink }} active{{ end }}">
                  {{ .Params.sidebar_title | default .Title }}
                </a>
              {{- end }}
            {{- else }}
              <a href="{{ .RelPermalink }}" class="sidebar-link{{ if eq .RelPermalink $.current.RelPermalink }} active{{ end }}">
                {{ .Params.sidebar_title | default .Title }}
              </a>
            {{- end }}
          </div>
        </div>
      {{- else }}
        {{- $apps := site.Data.app_gallery.apps | default (slice) -}}
        {{- $isGallery := and (eq .RelPermalink "/docs/demos/") (gt (len $apps) 0) -}}
        {{- if $isGallery -}}
          {{- $currentRel := $.current.RelPermalink -}}
          {{- $open := eq $currentRel .RelPermalink -}}
          {{- if not $open -}}
            {{- range $apps -}}
              {{- $detailPath := .detail_page -}}
              {{- $detailPage := cond (and $detailPath (ne $detailPath "")) (site.GetPage (printf "/%s" $detailPath)) nil -}}
              {{- $targetRel := "" -}}
              {{- if $detailPage -}}
                {{- $targetRel = $detailPage.RelPermalink -}}
              {{- else if $detailPath -}}
                {{- $targetRel = printf "/%s/" (trim $detailPath "/") -}}
              {{- end -}}
              {{- if and (ne $targetRel "") (eq $targetRel $currentRel) -}}
                {{- $open = true -}}
              {{- end -}}
            {{- end -}}
          {{- end -}}
          <details {{ if $open }}open{{ end }}>
            <summary class="sidebar-summary">
              <span class="sidebar-arrow">
                {{ readFile "static/assets/icons/arrow_down.svg" | safeHTML }}
              </span>
              <div class="sidebar-link-wrapper">
                <a href="{{ .RelPermalink }}" class="sidebar-link{{ if eq .RelPermalink $.current.RelPermalink }} active{{ end }}">
                  {{ .Params.sidebar_title | default .Title }}
                </a>
              </div>
            </summary>
            {{ partial "docs-sidebar-app-links.html" (dict "apps" $apps "current" $.current) }}
          </details>
        {{- else -}}
          <div class="sidebar-summary">
            <span class="sidebar-arrow-placeholder"></span>
            <div class="sidebar-link-wrapper">
              {{- if .Params.link }}
                {{- if hasPrefix .Params.link "http" }}
                  <a href="{{ .Params.link }}" class="sidebar-link{{ if eq .RelPermalink $.current.RelPermalink }} active{{ end }}" target="_blank" rel="noopener">
                    {{ .Params.sidebar_title | default .Title }}
                  </a>
                {{- else }}
                  <a href="{{ .Params.link }}" class="sidebar-link{{ if eq .RelPermalink $.current.RelPermalink }} active{{ end }}">
                    {{ .Params.sidebar_title | default .Title }}
                  </a>
                {{- end }}
              {{- else }}
                <a href="{{ .RelPermalink }}" class="sidebar-link{{ if eq .RelPermalink $.current.RelPermalink }} active{{ end }}">
                  {{ .Params.sidebar_title | default .Title }}
                </a>
              {{- end }}
            </div>
          </div>
        {{- end }}
      {{- end }}
    </li>
  {{- end }}
</ul> 
